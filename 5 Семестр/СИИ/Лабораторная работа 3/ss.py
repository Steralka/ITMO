import numpy as np                 # –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É NumPy, –æ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏ (ndarray),
                                   # –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ª–∏–Ω–µ–π–Ω—É—é –∞–ª–≥–µ–±—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–º–Ω–æ–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü, –ø—Å–µ–≤–¥–æ–æ–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞, —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç.–¥.).
                                   # –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –≤—Å–µ—Ö —á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

import pandas as pd                # –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É pandas ‚Äî –æ–Ω–∞ –Ω—É–∂–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (DataFrame),
                                   # –∫–æ—Ç–æ—Ä—ã–µ —É–¥–æ–±–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏).
                                   # pandas –≤–Ω—É—Ç—Ä–∏ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –±–∞–∑–µ numpy, –Ω–æ —Å –º–µ—Ç–∫–∞–º–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ —Å—Ç—Ä–æ–∫.

import matplotlib.pyplot as plt    # matplotlib.pyplot ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤.
                                   # –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ plt.plot(), plt.bar(), plt.hist(), plt.show().
                                   # –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∏–∑ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã, scatter –∏ —Ç.–¥.) —Å—Ç—Ä–æ—è—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –º–æ–¥—É–ª—è.

from prettytable import PrettyTable # –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å PrettyTable ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏.
                                   # –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å ‚ÄúASCII-—Ç–∞–±–ª–∏—Ü—É‚Äù —Å —Ä–∞–º–∫–∞–º–∏, –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏, —á—Ç–æ–±—ã –∫—Ä–∞—Å–∏–≤–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

# ---------- 1) –ó–∞–≥—Ä—É–∑–∫–∞ ----------
df = pd.read_csv("california_housing_train.csv")  # pd.read_csv —á–∏—Ç–∞–µ—Ç CSV-—Ñ–∞–π–ª (—Ç–∞–±–ª–∏—Ü—É, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –∑–∞–ø—è—Ç—ã–º–∏).
                                                  # "df" (dataframe) ‚Äî –æ–±—ä–µ–∫—Ç pandas, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å—Ç—Ä–æ–∫–∏ –∏ —Å—Ç–æ–ª–±—Ü—ã.
                                                  # pandas –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ—ë –∫–∞–∫ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫.
                                                  # –∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤–Ω—É—Ç—Ä–∏ df ‚Äî —ç—Ç–æ Series (–æ–¥–Ω–æ–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å –º–µ—Ç–∫–∞–º–∏).
                                                  # —Ç–µ–ø–µ—Ä—å df —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∞–±–ª–∏—Ü—É —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ (latitude, longitude, income, –∏ —Ç.–¥.) –∏ —Ü–µ–ª–µ–≤–æ–π –∫–æ–ª–æ–Ω–∫–æ–π median_house_value.

# ---------- –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ----------
quantiles = df.quantile([0.01, 0.05, 0.25, 0.5, 0.75, 0.95, 0.99])  # –º–µ—Ç–æ–¥ .quantile() –≤—ã—á–∏—Å–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –∫–≤–∞–Ω—Ç–∏–ª–µ–π.
                                                                    # –≤–Ω—É—Ç—Ä–∏ pandas –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ, 
                                                                    # –ø–æ—Å–ª–µ —á–µ–≥–æ –±–µ—Ä–µ—Ç—Å—è —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –ø—Ä–æ—Ü–µ–Ω—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.25 ‚Üí 25%).
                                                                    # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π DataFrame, –≥–¥–µ –∏–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –∫–≤–∞–Ω—Ç–∏–ª–µ–π, 
                                                                    # –∞ –∫–æ–ª–æ–Ω–∫–∏ ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏. 
                                                                    # –∑–¥–µ—Å—å –º—ã –±–µ—Ä–µ–º –∫–≤–∞–Ω—Ç–∏–ª–∏: 1%, 5%, 25%, –º–µ–¥–∏–∞–Ω—É, 75%, 95%, 99%.
                                                                    # quantiles.shape ‚âà (7 —Å—Ç—Ä–æ–∫ √ó N –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)

stats_basic = df.describe().T                                       # describe() –≤—ã—á–∏—Å–ª—è–µ—Ç –±–∞–∑–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (count, mean, std, min, 25%, 50%, 75%, max)
                                                                    # .T —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É, —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–ª–∞ –æ–¥–∏–Ω –ø—Ä–∏–∑–Ω–∞–∫, –∞ —Å—Ç–æ–ª–±—Ü—ã ‚Äî –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏.
                                                                    # —Ç–µ–ø–µ—Ä—å —Å—Ç—Ä–æ–∫–∏ ‚Äî –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Å—Ç–æ–ª–±—Ü—ã ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

stats_full = stats_basic.join(quantiles.T, how="left", rsuffix="_q") # –æ–±—ä–µ–¥–∏–Ω—è–µ–º –±–∞–∑–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É stats_basic —Å –∫–≤–∞–Ω—Ç–∏–ª–∏ (quantiles.T),
                                                                    # —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –≤—Å—ë –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ. 
                                                                    # join —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º (—É –Ω–∞—Å —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ –∏–º–µ–Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤).
                                                                    # rsuffix="_q" –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å "_q" –∫ —Å—Ç–æ–ª–±—Ü–∞–º –∏–∑ –ø—Ä–∞–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã, 
                                                                    # –µ—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "50%" –∏ "50%_q").

print("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º")                                     

table = PrettyTable()                                               
table.field_names = ["–ü—Ä–∏–∑–Ω–∞–∫", "count", "mean", "std", "min", "25%", "50%", "75%", "max"]  

for name, row in stats_basic.iterrows():                             # –∏—Ç–µ—Ä–∏—Ä—É–µ–º—Å—è –ø–æ —Å—Ç—Ä–æ–∫–∞–º DataFrame `stats_basic`.
                                                                    # iterrows() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä—É (index, Series), –≥–¥–µ
                                                                    # index = –∏–º—è –ø—Ä–∏–∑–Ω–∞–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äúlongitude‚Äù),
                                                                    # Series = —Å—Ç—Ä–æ–∫–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ —ç—Ç–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É (mean, std –∏ —Ç.–¥.)
    
    table.add_row([                                                  # –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É PrettyTable.
        name,                                                        # –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ (index)
        f"{row['count']:.0f}",                                       # –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ ‚Äúcount‚Äù, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –±–µ–∑ –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏
        f"{row['mean']:.2f}",                                        # —Å—Ä–µ–¥–Ω–µ–µ (mean), –æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        f"{row['std']:.2f}",                                         # —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (std)
        f"{row['min']:.2f}",                                         # –º–∏–Ω–∏–º—É–º
        f"{row['25%']:.2f}",                                         # –Ω–∏–∂–Ω–∏–π –∫–≤–∞—Ä—Ç–∏–ª—å (25%)
        f"{row['50%']:.2f}",                                         # –º–µ–¥–∏–∞–Ω–∞ (50%)
        f"{row['75%']:.2f}",                                         # –≤–µ—Ä—Ö–Ω–∏–π –∫–≤–∞—Ä—Ç–∏–ª—å (75%)
        f"{row['max']:.2f}"                                          # –º–∞–∫—Å–∏–º—É–º
    ])
print(table)                                                         # –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ –ø–µ—á–∞—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É.
                                                                    # –º–µ—Ç–æ–¥ PrettyTable —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤—Å—ë —Å —Ä–∞–º–∫–∞–º–∏ –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º.


# ---------- 2) Min‚ÄìMax –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ----------
y_name = "median_house_value"                                        # —É–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏–º –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å (—Ü–µ–Ω–∞ –¥–æ–º–∞).
y = df[y_name].values.astype(float)                                  # –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç–æ–ª–±–µ—Ü –∫–∞–∫ –º–∞—Å—Å–∏–≤ numpy (values), —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö.
                                                                    # .astype(float) ‚Äî —è–≤–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ —á–∏—Å–ª–æ–≤–æ–π (–∏–Ω–æ–≥–¥–∞ pandas –æ—Å—Ç–∞–≤–ª—è–µ—Ç float64 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

X_df = df.drop(columns=[y_name])                                     # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π DataFrame X_df, –∏—Å–∫–ª—é—á–∞—è —Ü–µ–ª–µ–≤—É—é –∫–æ–ª–æ–Ω–∫—É.
                                                                    # —Ç–µ–ø–µ—Ä—å X_df —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—Ñ–∞–∫—Ç–æ—Ä—ã).

X_min = X_df.min()                                                   # –≤—ã—á–∏—Å–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞.
                                                                    # pandas –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–æ–ª–±—Ü—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Series, –≥–¥–µ –∏–Ω–¥–µ–∫—Å ‚Äî –∏–º—è –ø—Ä–∏–∑–Ω–∞–∫–∞, –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –º–∏–Ω–∏–º—É–º.
X_max = X_df.max()                                                   # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ‚Äî Series —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É.

X_norm = (X_df - X_min) / (X_max - X_min)                            # –≤—ã–ø–æ–ª–Ω—è–µ–º min‚Äìmax –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é.
                                                                    # pandas –≤—ã—á–∏—Ç–∞–µ—Ç Series X_min –∏–∑ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ (broadcasting –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º),
                                                                    # –∑–∞—Ç–µ–º –¥–µ–ª–∏—Ç –ø–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ –Ω–∞ —Ä–∞–∑–Ω–∏—Ü—É (X_max - X_min).
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1].
                                                                    # –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ X_min == X_max, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç NaN.

X_norm = X_norm.fillna(0)                                            # –∑–∞–º–µ–Ω—è–µ–º NaN –Ω–∞ 0 (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Å—Ç–æ–ª–±–µ—Ü –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π).
                                                                    # —Ç–µ–ø–µ—Ä—å X_norm ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DataFrame, –≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –º–æ–¥–µ–ª–∏.

print("–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏")                                                # –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤—ã–≤–æ–¥–∞ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

for col in ["longitude", "latitude", "housing_median_age", "median_income"]:  
                                                                    # –≤—ã–±–∏—Ä–∞–µ–º 4 –ø—Ä–∏–∑–Ω–∞–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ ‚Äú–¥–æ/–ø–æ—Å–ª–µ‚Äù –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

    t = PrettyTable()                                                # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É PrettyTable –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞.
    t.field_names = [f"–ü—Ä–∏–∑–Ω–∞–∫: {col}", "–î–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏", "–ü–æ—Å–ª–µ (0‚Äì1)"]  
                                                                    # –∑–∞–¥–∞—ë–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Äî –∏–º—è –ø—Ä–∏–∑–Ω–∞–∫–∞ –∏ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π.

    for i in range(5):                                               # –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
        t.add_row([i+1,                                              # –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Å –∏–Ω–¥–µ–∫—Å–æ–º (1, 2, 3, 4, 5)
                   f"{X_df[col].iloc[i]:.2f}",                       # –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ –¥–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–∫—Ä—É–≥–ª—ë–Ω–Ω–æ–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤
                   f"{X_norm[col].iloc[i]:.4f}"])                    # –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, 4 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    print(t)                                                         # –≤—ã–≤–æ–¥–∏–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞

# ---------- 3) –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ train/test ----------
rng = np.random.default_rng(42)                                      # —Å–æ–∑–¥–∞—ë–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª NumPy —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º "seed" = 42.
                                                                    # —ç—Ç–æ—Ç seed –¥–µ–ª–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º–∏:
                                                                    # –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞—Å—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ.
                                                                    # new Generator API –≤ NumPy (–≤–º–µ—Å—Ç–æ np.random.seed + np.random) –¥–∞—ë—Ç –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

idx = np.arange(len(df))                                             # —Å–æ–∑–¥–∞—ë–º –º–∞—Å—Å–∏–≤ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –æ—Ç 0 –¥–æ N-1, –≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ df.
                                                                    # np.arange –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤ numpy.ndarray.
                                                                    # –ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ df –∏–º–µ–µ—Ç 17000 —Å—Ç—Ä–æ–∫, idx = [0, 1, 2, ..., 16999].

rng.shuffle(idx)                                                     # –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ idx —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º "–Ω–∞ –º–µ—Å—Ç–µ".
                                                                    # —Ç–µ–ø–µ—Ä—å –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–µ—Ä–µ–º–µ—à–∞–Ω: –Ω–∞–ø—Ä–∏–º–µ—Ä [132, 501, 5, 14999, ...].
                                                                    # –≤–∞–∂–Ω–æ: –¥–∞–Ω–Ω—ã–µ –≤ df –Ω–µ –º–µ–Ω—è—é—Ç—Å—è, –º—ã –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—ë–º –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏.

test_ratio = 0.2                                                     # –∑–∞–¥–∞—ë–º –¥–æ–ª—é —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ ‚Äî 20%.
test_size = int(len(idx) * test_ratio)                               # –≤—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏:
                                                                    # 0.2 * 17000 = 3400.
                                                                    # –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ int() (—á—Ç–æ–±—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç—å float).

test_idx = idx[:test_size]                                           # –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 3400 –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–∑ –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏.
train_idx = idx[test_size:]                                          # –æ—Å—Ç–∞–≤—à–∏–µ—Å—è 13600 –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–æ–π–¥—É—Ç –≤ –æ–±—É—á–∞—é—â—É—é –≤—ã–±–æ—Ä–∫—É.
                                                                    # —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º train/test –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è, –∏ –æ–±–∞ –Ω–∞–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω—ã.

X = X_norm.values                                                    # –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ DataFrame X_norm –∫–∞–∫ —á–∏—Å—Ç—ã–π NumPy –º–∞—Å—Å–∏–≤ (–¥–≤—É–º–µ—Ä–Ω—ã–π).
                                                                    # —Ç–µ–ø–µ—Ä—å X ‚Äî —ç—Ç–æ –º–∞—Ç—Ä–∏—Ü–∞ —Ä–∞–∑–º–µ—Ä–æ–º [N, M], –≥–¥–µ N ‚Äî —á–∏—Å–ª–æ –æ–±—Ä–∞–∑—Ü–æ–≤, M ‚Äî —á–∏—Å–ª–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

X_train, X_test = X[train_idx], X[test_idx]                          # —Å–æ–∑–¥–∞—ë–º –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –º–∞—Ç—Ä–∏—Ü—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é –∏–Ω–¥–µ–∫—Å–æ–≤.
                                                                    # –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è NumPy –º–∞—Å—Å–∏–≤–æ–≤ –ø–æ –º–∞—Å—Å–∏–≤–∞–º –∏–Ω–¥–µ–∫—Å–æ–≤ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏.
                                                                    # –ø—Ä–∏–º–µ—Ä: X_train.shape ‚âà (13600, 8), X_test.shape ‚âà (3400, 8).

y_train, y_test = y[train_idx], y[test_idx]                          # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–µ–ª–∏–º —Ü–µ–ª–µ–≤–æ–π –≤–µ–∫—Ç–æ—Ä y –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é —á–∞—Å—Ç–∏.
                                                                    # —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å X_train, y_train ‚Üí –æ–±—É—á–µ–Ω–∏–µ;
                                                                    # X_test, y_test ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏.
                                                                    
def add_intercept(X):
    return np.hstack([np.ones((X.shape[0], 1)), X])                  # np.ones —Å–æ–∑–¥–∞—ë—Ç —Å—Ç–æ–ª–±–µ—Ü –∏–∑ 1 —Ä–∞–∑–º–µ—Ä–æ–º [N,1].
                                                                    # np.hstack() —Å–∫–ª–µ–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —Å—Ç–æ–ª–±–µ—Ü —Å–ª–µ–≤–∞ –∫ –º–∞—Ç—Ä–∏—Ü–µ X (–ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏).
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–æ–≤–∞—è –º–∞—Ç—Ä–∏—Ü–∞ X1 —Ä–∞–∑–º–µ—Ä–æ–º [N, M+1], –≥–¥–µ –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞.
                                                                    # –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –º–æ–≥–ª–∞ –ø–æ–¥–±–∏—Ä–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —É–≥–ª—ã (Œ≤1, Œ≤2...), –Ω–æ –∏ —Å–º–µ—â–µ–Ω–∏–µ Œ≤0.

def ols_fit(X, y):                                                   # —Ñ—É–Ω–∫—Ü–∏—è "–æ–±—É—á–µ–Ω–∏—è" –ª–∏–Ω–µ–π–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ (–º–µ—Ç–æ–¥ –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤)
    return np.linalg.pinv(add_intercept(X)) @ y                      # —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ Œ≤:
                                                                    # Œ≤ = (X‚Å∫) * y, –≥–¥–µ X‚Å∫ ‚Äî –ø—Å–µ–≤–¥–æ–æ–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ (Moore-Penrose inverse).
                                                                    # np.linalg.pinv() –≤—ã—á–∏—Å–ª—è–µ—Ç –ø—Å–µ–≤–¥–æ–æ–±—Ä–∞—Ç–Ω—É—é —Å –ø–æ–º–æ—â—å—é SVD (—É—Å—Ç–æ–π—á–∏–≤–æ –∫ –≤—ã—Ä–æ–∂–¥–µ–Ω–Ω—ã–º –º–∞—Ç—Ä–∏—Ü–∞–º).
                                                                    # –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∞—Ç—Ä–∏—á–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ @.
                                                                    # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º Œ≤ –≤ –≤–∏–¥–µ –≤–µ–∫—Ç–æ—Ä–∞ –¥–ª–∏–Ω–æ–π M+1 (–≤–∫–ª—é—á–∞—è —Å–≤–æ–±–æ–¥–Ω—ã–π —á–ª–µ–Ω).

def ols_predict(X, beta):                                           # —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    return add_intercept(X) @ beta                                  # —Å–Ω–æ–≤–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–ª–±–µ—Ü –∏–∑ 1 –∏ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ –≤–µ–∫—Ç–æ—Ä Œ≤.
                                                                    # @ ‚Äî —ç—Ç–æ –º–∞—Ç—Ä–∏—á–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (np.dot).
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –≤–µ–∫—Ç–æ—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö yÃÇ (–æ–¥–Ω–æ–º–µ—Ä–Ω—ã–π –º–∞—Å—Å–∏–≤).

def r2_score(y_true, y_pred):                                        # —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–≤–æ—é –º–µ—Ç—Ä–∏–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏ R¬≤)
    ss_res = np.sum((y_true - y_pred)**2)                            # SSR (sum of squared residuals) ‚Äî —Å—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–∏.
                                                                    # –∫–∞–∂–¥–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (y_i - ≈∑_i) –≤–æ–∑–≤–æ–¥–∏—Ç—Å—è –≤ –∫–≤–∞–¥—Ä–∞—Ç, –∑–∞—Ç–µ–º —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è.

    ss_tot = np.sum((y_true - y_true.mean())**2)                     # SST (total sum of squares) ‚Äî –¥–∏—Å–ø–µ—Ä—Å–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
                                                                    # —Ä–∞–∑–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –∫–∞–∂–¥—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ —Å—Ä–µ–¥–Ω–∏–º –ø–æ –≤—ã–±–æ—Ä–∫–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ.

    return 1 - ss_res / ss_tot if ss_tot != 0 else 0.0               # —Ñ–æ—Ä–º—É–ª–∞ R¬≤ = 1 - SSR/SST.
                                                                    # –µ—Å–ª–∏ SST=0 (–≤—Å–µ y –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å.


all_cols = list(X_df.columns)                                        # –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –Ω–∞–±–æ—Ä–µ X_df.
                                                                    # –æ–Ω –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –ø–æ –∏–º–µ–Ω–∏ –ø–æ—Ç–æ–º –Ω–∞–π—Ç–∏ –∏–Ω–¥–µ–∫—Å –ø—Ä–∏–∑–Ω–∞–∫–∞ –≤ –º–∞—Ç—Ä–∏—Ü–µ X.
                                                                    # –ø—Ä–∏–º–µ—Ä: all_cols = ["longitude", "latitude", ..., "median_income"]

m1_cols = ["median_income"]                                          # –¥–ª—è –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏ –±–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ –¥–æ—Ö–æ–¥.
m2_cols = ["longitude", "latitude", "housing_median_age", "median_income"]
                                                                    # –¥–ª—è –≤—Ç–æ—Ä–æ–π ‚Äî –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –≤–æ–∑—Ä–∞—Å—Ç –∏ –¥–æ—Ö–æ–¥.

m1_idx = [all_cols.index(c) for c in m1_cols]                        # –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ m1_cols –∏—â–µ–º –µ—ë –∏–Ω–¥–µ–∫—Å –≤ all_cols.
m2_idx = [all_cols.index(c) for c in m2_cols]                        # —Ç–æ –∂–µ –¥–ª—è –≤—Ç–æ—Ä–æ–π –º–æ–¥–µ–ª–∏.
                                                                    # —Ç–∞–∫ –ø–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –Ω—É–∂–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ numpy-–º–∞—Å—Å–∏–≤–µ X.

df_eng = df.copy()                                                   # —Å–æ–∑–¥–∞—ë–º –∫–æ–ø–∏—é –∏—Å—Ö–æ–¥–Ω–æ–≥–æ DataFrame, —á—Ç–æ–±—ã –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å df –Ω–∞–ø—Ä—è–º—É—é.
                                                                    # –¥–∞–ª—å—à–µ –≤ –Ω–µ—ë –¥–æ–±–∞–≤–∏–º —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏.

df_eng["rooms_per_household"] = df_eng["total_rooms"] / df_eng["households"].replace(0, np.nan)
                                                                    # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç –Ω–∞ –æ–¥–Ω–æ –¥–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤–æ.
                                                                    # —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∏–º total_rooms –Ω–∞ households.
                                                                    # .replace(0, np.nan) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å (—á—Ç–æ–±—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç—å inf).
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî float —Å NaN —Ç–∞–º, –≥–¥–µ –±—ã–ª–æ –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 0.

df_eng["bedrooms_per_room"] = df_eng["total_bedrooms"] / df_eng["total_rooms"].replace(0, np.nan)
                                                                    # –≤—Ç–æ—Ä–æ–π —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑–Ω–∞–∫ ‚Äî –¥–æ–ª—è —Å–ø–∞–ª–µ–Ω –æ—Ç –≤—Å–µ—Ö –∫–æ–º–Ω–∞—Ç (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –∂–∏–ª—å—è).
                                                                    # –¥–µ–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞—â–∏—â–µ–Ω–æ –∑–∞–º–µ–Ω–æ–π –Ω—É–ª–µ–π –Ω–∞ NaN.

df_eng["population_per_household"] = df_eng["population"] / df_eng["households"].replace(0, np.nan)
                                                                    # —Ç—Ä–µ—Ç–∏–π —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑–Ω–∞–∫ ‚Äî –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è –≤ –¥–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ.
                                                                    # —Ç–æ–∂–µ –∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0.

df_eng = df_eng.fillna(0)                                            # –∑–∞–º–µ–Ω—è–µ–º –≤—Å–µ NaN, –≤–æ–∑–Ω–∏–∫—à–∏–µ –ø—Ä–∏ –¥–µ–ª–µ–Ω–∏–∏, –Ω–∞ 0.
                                                                    # —Ç–µ–ø–µ—Ä—å df_eng –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.

y3 = df_eng[y_name].values.astype(float)                             # –≤—ã–¥–µ–ª—è–µ–º —Ü–µ–ª–µ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (—Ü–µ–Ω—ã –¥–æ–º–æ–≤) –¥–ª—è –º–æ–¥–µ–ª–∏ 3.
X3_df = df_eng.drop(columns=[y_name])                                # –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–≤–∫–ª—é—á–∞—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ).

X3_min = X3_df.min()                                                 # –≤—ã—á–∏—Å–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É –≤ df_eng.
X3_max = X3_df.max()                                                 # –≤—ã—á–∏—Å–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
X3_norm = (X3_df - X3_min) / (X3_max - X3_min)                       # –ø—Ä–∏–º–µ–Ω—è–µ–º min‚Äìmax –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é (–ø—Ä–∏–≤–æ–¥–∏–º –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É 0‚Äì1).
X3_norm = X3_norm.fillna(0)                                          # –∑–∞–º–µ–Ω—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ NaN –Ω–∞ 0 (–≤ —Å–ª—É—á–∞–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤).

X3 = X3_norm.values                                                  # –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ DataFrame —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –≤–∏–¥–µ numpy-–º–∞—Å—Å–∏–≤–∞.
X3_train, X3_test = X3[train_idx], X3[test_idx]                      # —Ä–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ train –∏ test –ø–æ —Ç–µ–º –∂–µ –∏–Ω–¥–µ–∫—Å–∞–º, —á—Ç–æ –∏ —Ä–∞–Ω—å—à–µ.
y3_train, y3_test = y3[train_idx], y3[test_idx]                      # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

beta1 = ols_fit(X_train[:, m1_idx], y_train)                         # –æ–±—É—á–∞–µ–º –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å (M1):
                                                                    # X_train[:, m1_idx] ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –æ–±—É—á–∞—é—â–µ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–¥–æ—Ö–æ–¥).
                                                                    # –≤–Ω—É—Ç—Ä–∏ ols_fit() ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç–æ–ª–±–µ—Ü –∏–∑ 1, –∑–∞—Ç–µ–º —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã Œ≤.
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç beta1 ‚Äî —ç—Ç–æ NumPy-–≤–µ–∫—Ç–æ—Ä –¥–ª–∏–Ω–æ–π (1 + –∫–æ–ª-–≤–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤), —Ç.–µ. [Œ≤0, Œ≤1].

beta2 = ols_fit(X_train[:, m2_idx], y_train)                         # –æ–±—É—á–∞–µ–º –≤—Ç–æ—Ä—É—é –º–æ–¥–µ–ª—å (M2) —Å 4 –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏: –¥–æ–ª–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞, –≤–æ–∑—Ä–∞—Å—Ç, –¥–æ—Ö–æ–¥.
                                                                    # —Ç–∞–∫–∂–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã Œ≤ (–≤–µ–∫—Ç–æ—Ä –¥–ª–∏–Ω–æ–π 5).

beta3 = ols_fit(X3_train, y3_train)                                  # –æ–±—É—á–∞–µ–º —Ç—Ä–µ—Ç—å—é –º–æ–¥–µ–ª—å (M3), –∏—Å–ø–æ–ª—å–∑—É—é—â—É—é –≤—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ + —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ.
                                                                    # X3_train —Å–æ–¥–µ—Ä–∂–∏—Ç —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–æ–∑–º–æ–∂–Ω–æ –¥–µ—Å—è—Ç–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤.
                                                                    # np.linalg.pinv() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Œ≤ ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—â–∏–µ —Å—É–º–º—É –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫.
y1_te = ols_predict(X_test[:, m1_idx], beta1)                        # –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–Ω—ã –¥–æ–º–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –≤ –º–æ–¥–µ–ª–∏ M1.
                                                                    # –≤–Ω—É—Ç—Ä–∏ ols_predict –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω–∏—á–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü, –∑–∞—Ç–µ–º —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ Œ≤.
                                                                    # —Ä–µ–∑—É–ª—å—Ç–∞—Ç y1_te ‚Äî NumPy-–≤–µ–∫—Ç–æ—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª–∏–Ω–æ–π len(X_test).

y2_te = ols_predict(X_test[:, m2_idx], beta2)                        # —Ç–æ –∂–µ –¥–ª—è –º–æ–¥–µ–ª–∏ M2.
y3_te = ols_predict(X3_test, beta3)                                  # –∏ –¥–ª—è –º–æ–¥–µ–ª–∏ M3, –∫–æ—Ç–æ—Ä–∞—è –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ X3_test.

r2_1 = r2_score(y_test, y1_te)                                       # –æ—Ü–µ–Ω–∏–≤–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏ M1:
                                                                    # –≤—ã—á–∏—Å–ª—è–µ–º R¬≤ = 1 - SSR/SST.
                                                                    # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–∫–∞–ª—è—Ä (float) –æ—Ç 0 –¥–æ 1.
r2_2 = r2_score(y_test, y2_te)                                       # —Ç–æ –∂–µ –¥–ª—è M2.
r2_3 = r2_score(y3_test, y3_te)                                      # –∏ –¥–ª—è M3.

print("üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π (Min‚ÄìMax –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)")             # –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.
compare = PrettyTable()                                              # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É PrettyTable.
compare.field_names = ["–ú–æ–¥–µ–ª—å", "–ü—Ä–∏–∑–Ω–∞–∫–∏", "R¬≤ (test)"]            # –∑–∞–¥–∞—ë–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ.

compare.add_row(["M1", "median_income", f"{r2_1:.4f}"])              # –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –º–æ–¥–µ–ª–∏ 1.
                                                                    # f"{r2_1:.4f}" —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ —Å 4 –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.

compare.add_row(["M2", "geo + age + income", f"{r2_2:.4f}"])         # –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –º–æ–¥–µ–ª–∏ 2.
compare.add_row(["M3", "–≤—Å–µ + —Å–∏–Ω—Ç–µ—Ç–∏–∫–∞", f"{r2_3:.4f}"])            # –∏ –¥–ª—è –º–æ–¥–µ–ª–∏ 3.

print(compare)                                                       # PrettyTable –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–ª–±—Ü—ã –∏ —Ä–∏—Å—É–µ—Ç —Ä–∞–º–∫–∏.


plt.figure(figsize=(8,5))                                            # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ (canvas) —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ 8√ó5 –¥—é–π–º–æ–≤.
plt.bar(["M1","M2","M3"], [r2_1, r2_2, r2_3],                       # —Ä–∏—Å—É–µ–º —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É:
        color=["#6fa8dc","#93c47d","#f6b26b"])                      # –∑–∞–¥–∞—ë–º —Ç—Ä–∏ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤.
plt.title("üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π (R¬≤)")                      # –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞.
plt.ylabel("R¬≤ (–Ω–∞ —Ç–µ—Å—Ç–µ)")                                          # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ Y.

for i, v in enumerate([r2_1, r2_2, r2_3]):                           # —Ü–∏–∫–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –∏ –∑–Ω–∞—á–µ–Ω–∏—è–º R¬≤.
    plt.text(i, v+0.005, f"{v:.3f}", ha='center', fontweight='bold') # —Ä–∏—Å—É–µ–º –ø–æ–¥–ø–∏—Å–∏ –Ω–∞–¥ –∫–∞–∂–¥—ã–º —Å—Ç–æ–ª–±—Ü–æ–º (–≤—ã—Å–æ—Ç–∞ = v+0.005).
plt.tight_layout()                                                   # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥–æ–Ω—è–µ—Ç –æ—Ç—Å—Ç—É–ø—ã, —á—Ç–æ–±—ã –≤—Å—ë –≤–ª–µ–∑–ª–æ.
plt.show()                                                           # –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –≤ –æ–∫–Ω–µ / –Ω–æ—É—Ç–±—É–∫–µ.

y1_true, y2_true, y3_true = y_test, y_test, y3_test                  # –∫–æ–ø–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤—ã –∏—Å—Ç–∏–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, —á—Ç–æ–±—ã –Ω–µ –ø—É—Ç–∞—Ç—å—Å—è –ø—Ä–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏.
fig, axs = plt.subplots(1, 3, figsize=(16, 5))                       # —Å–æ–∑–¥–∞—ë–º –ø–æ–ª–æ—Ç–Ω–æ (Figure) —Å 3 –ø–æ–¥–≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (axes) –≤ 1 —Å—Ç—Ä–æ–∫–µ.
                                                                    # axs ‚Äî —ç—Ç–æ –º–∞—Å—Å–∏–≤ –∏–∑ —Ç—Ä—ë—Ö –æ—Å–µ–π (AxesSubplot).

models = [                                                           # —Å–ø–∏—Å–æ–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è —Ü–∏–∫–ª–∞.
    ("M1: median_income", y1_true, y1_te, "#6fa8dc"),                # –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç = (–∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ñ–∞–∫—Ç—ã, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, —Ü–≤–µ—Ç).
    ("M2: geo + age + income", y2_true, y2_te, "#93c47d"),
    ("M3: full + engineered", y3_true, y3_te, "#f6b26b")
]

for ax, (title, y_t, y_h, color) in zip(axs, models):                # –ø—Ä–æ—Ö–æ–¥–∏–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ –æ—Å—è–º –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –º–æ–¥–µ–ª–µ–π.
    ax.scatter(y_t, y_h, s=10, color=color, alpha=0.6)               # —Å—Ç—Ä–æ–∏–º scatter-–≥—Ä–∞—Ñ–∏–∫: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ y_t (–ø–æ X-–æ—Å–∏) –ø—Ä–æ—Ç–∏–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö y_h (–ø–æ Y-–æ—Å–∏).
                                                                    # s=10 ‚Äî —Ä–∞–∑–º–µ—Ä —Ç–æ—á–∫–∏, alpha=0.6 ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å.

    lims = [min(y_t.min(), y_h.min()), max(y_t.max(), y_h.max())]    # –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –≥—Ä–∞—Ñ–∏–∫–∞ (–º–∏–Ω–∏–º—É–º –∏ –º–∞–∫—Å–∏–º—É–º –ø–æ –æ–±–µ–∏–º –æ—Å—è–º),
                                                                    # —á—Ç–æ–±—ã –ª–∏–Ω–∏—è "y=x" —à–ª–∞ –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –≤—Å–µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.

    ax.plot(lims, lims, 'r--', lw=1)                                 # —Ä–∏—Å—É–µ–º –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é –∫—Ä–∞—Å–Ω—É—é –¥–∏–∞–≥–æ–Ω–∞–ª—å (–∏–¥–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è: yÃÇ = y).
    ax.set_title(title, fontsize=11, fontweight='bold')              # –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–¥ –∫–∞–∂–¥—ã–º –ø–æ–¥–≥—Ä–∞—Ñ–∏–∫–æ–º.
    ax.set_xlabel("–§–∞–∫—Ç")                                            # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ X.
    ax.set_ylabel("–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ")                                    # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ Y.
    ax.grid(alpha=0.3)                                               # –≤–∫–ª—é—á–∞–µ–º —Å–µ—Ç–∫—É —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é 30%.

plt.suptitle("üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π: –§–∞–∫—Ç vs –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ", fontsize=14, fontweight='bold')  
                                                                    # –æ–±—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤—Å–µ–π —Ñ–∏–≥—É—Ä—ã (suptitle = super title).
plt.tight_layout(rect=[0, 0.03, 1, 0.95])                            # –¥–µ–ª–∞–µ–º –æ—Ç—Å—Ç—É–ø –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–æ–∫.
plt.show()                                                           # –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ 3 scatter-–≥—Ä–∞—Ñ–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –æ–∫–Ω–µ.

fig, axs = plt.subplots(1, 3, figsize=(16, 4))                       # —Å–Ω–æ–≤–∞ —Å–æ–∑–¥–∞—ë–º 3 –ø–æ–¥–≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π.

residuals = [                                                        # —Å–æ–±–∏—Ä–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞—Ç–∫–æ–≤ (–æ—à–∏–±–æ–∫) –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏.
    ("M1", y1_true - y1_te, "#6fa8dc"),                              # –æ—Å—Ç–∞—Ç–∫–∏ = y - ≈∑.
    ("M2", y2_true - y2_te, "#93c47d"),
    ("M3", y3_true - y3_te, "#f6b26b")
]

for ax, (name, res, color) in zip(axs, residuals):                   # –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –º–æ–¥–µ–ª–∏ –∏ –æ—Å–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤.
    ax.hist(res, bins=40, color=color, edgecolor='black', alpha=0.8) # —Å—Ç—Ä–æ–∏–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –æ—à–∏–±–æ–∫.
                                                                    # bins=40 ‚Äî —Ä–∞–∑–±–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–∞ 40 "–∫–æ—Ä–∑–∏–Ω".
                                                                    # edgecolor='black' ‚Äî —á—ë—Ä–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç–æ–ª–±—Ü–æ–≤.

    ax.set_title(f"–û—Å—Ç–∞—Ç–∫–∏ ‚Äî {name}", fontweight='bold')             # –ø–æ–¥–ø–∏—Å—å –Ω–∞–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º.
    ax.set_xlabel("–û—à–∏–±–∫–∞ (y - ≈∑)")                                  # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ X (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è).
    ax.set_ylabel("–ß–∞—Å—Ç–æ—Ç–∞")                                         # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ Y.
    ax.grid(alpha=0.3)                                               # –¥–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ç–∫—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è.

plt.suptitle("üìâ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ø–æ –º–æ–¥–µ–ª—è–º", fontsize=14, fontweight='bold')  # –æ–±—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫.
plt.tight_layout(rect=[0, 0.03, 1, 0.95])                            # –æ—Ç—Å—Ç—É–ø –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–æ–∫.
plt.show()                                                           # –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ 3 –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã.

best_model = max([(r2_1, "M1", y_test, y1_te),                      # —Å–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π (r2, –∏–º—è, y_true, y_pred).
                  (r2_2, "M2", y_test, y2_te),
                  (r2_3, "M3", y3_test, y3_te)], key=lambda x: x[0])
                                                                    # max() –∏—â–µ—Ç –∫–æ—Ä—Ç–µ–∂ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø–µ—Ä–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º (r2).
                                                                    # key=lambda x: x[0] –æ–∑–Ω–∞—á–∞–µ—Ç "—Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø–æ R¬≤".
                                                                    # –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä (0.73, 'M3', y3_test, y3_te).
_, best_name, y_true, y_hat = best_model                             # —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∫–æ—Ä—Ç–µ–∂: –∏–º—è –º–æ–¥–µ–ª–∏, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.


plt.figure(figsize=(6,6))                                            # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ (–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç 6√ó6).
plt.scatter(y_true, y_hat, s=10, color='teal')                       # scatter-–≥—Ä–∞—Ñ–∏–∫: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ç–∏–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö.
lims = [min(y_true.min(), y_hat.min()), max(y_true.max(), y_hat.max())]  # –≤—ã—á–∏—Å–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –æ—Å–µ–π (–ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é).
plt.plot(lims, lims, 'r--')                                          # —Ä–∏—Å—É–µ–º –∫—Ä–∞—Å–Ω—É—é –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é –¥–∏–∞–≥–æ–Ω–∞–ª—å y=x.
plt.xlabel("–§–∞–∫—Ç")                                                   # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ X.
plt.ylabel("–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ")                                           # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ Y.
plt.title(f"–§–∞–∫—Ç vs –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ ‚Äî {best_name}")                     # –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏.
plt.tight_layout()                                                   # –ø–æ–¥–≥–æ–Ω—è–µ–º –æ—Ç—Å—Ç—É–ø—ã.
plt.show()                                                           # –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫.

residuals = y_true - y_hat                                           # –≤—ã—á–∏—Å–ª—è–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π: —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ñ–∞–∫—Ç –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ–º.
plt.figure(figsize=(8,5))                                            # —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ –æ–∫–Ω–æ –≥—Ä–∞—Ñ–∏–∫–∞.
plt.hist(residuals, bins=40, edgecolor='black', color='salmon')      # —Å—Ç—Ä–æ–∏–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –æ—Å—Ç–∞—Ç–∫–æ–≤.
plt.title(f"–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ ‚Äî {best_name}")                   # –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–º–µ–Ω–µ–º –º–æ–¥–µ–ª–∏.
plt.xlabel("–û—Å—Ç–∞—Ç–æ–∫ (y - ≈∑)")                                        # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ X.
plt.ylabel("–ß–∞—Å—Ç–æ—Ç–∞")                                                # –ø–æ–¥–ø–∏—Å—å –æ—Å–∏ Y.
plt.tight_layout()                                                   # –ø–æ–¥–≥–æ–Ω—è–µ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ.
plt.show()                                                           # –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫.
